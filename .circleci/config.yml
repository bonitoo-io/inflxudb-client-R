version: 2
jobs:
  "R-4.0":
    docker:
      - image: rocker/tidyverse:4.0.5
    steps:
      - checkout
      - run:
          name: Install package dependencies
          command: R -e "devtools::install_deps(dep = TRUE)"
      - run:
          name: Build package
          command: R CMD build .
      - run:
          name: Check package
          command: R CMD check --no-manual *tar.gz

  "R-3.3":
    docker:
      - image: rstudio/r-base:3.3.3-bionic
    steps:
      - checkout
      - run:
          name: Install openssl
          command: sudo apt-add-repository 'deb http://security.ubuntu.com/ubuntu bionic-security main' && sudo apt-get install -y libssl-dev
      - run:
          name: Install package dependencies
          command: R -e "install.packages(c(\"httr\", \"jsonlite\", \"base64enc\", \"bit64\", \"nanotime\", \"plyr\"), repos = \"https://cran.r-project.org\")"
      - run:
          name: Install test dependencies
          command: R -e "install.packages(c(\"rlang\", \"magrittr\", \"testthat\", \"httptest\"), repos = \"https://cran.r-project.org\")"
#      - run:
#          name: Install package dependencies
#          command: R -e "devtools::install_deps(dep = TRUE)"
#      - run:
#          name: Update selected packages
#          command: R -e "remotes::install_github(\"rcppcore/rcpp\"); remotes::install_github(\"eddelbuettel/rcppcctz\"); remotes::install_github(\"eddelbuettel/rcppdate\"); remotes::install_github(\"eddelbuettel/nanotime\")"
      - run:
          name: Build package
          command: R CMD build .
      - run:
          name: Check package
          command: R CMD check --no-manual *tar.gz

workflows:
  version: 2
  build:
    jobs:
      - "R-4.0"
      - "R-3.3"
